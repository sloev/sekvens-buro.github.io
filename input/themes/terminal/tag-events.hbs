{{> head}}
{{> navbar}}
<main class="content page">
   {{#tag}}

   {{#if tagViewConfig.displayPostList}}
   <div class="posts">
      
            {{orderby ../posts 'createdAt' 'DESC'}}

      {{#each ../posts}}

      <article class="post">
            
         <div class="post_content_area">
 <header>
               <h2 class="h1 post__title"><a href="{{url}}">{{title}}</a><br>
             
               üìÖ {{ date createdAt 'Do MMM YYYY'}}<br>
                     {{#checkIf postViewConfig.ticketPresalePrice "!=" ""}}
               üé´  {{ postViewConfig.ticketPresalePrice}} kr {{#if postViewConfig.ticketsEnabled}} <i><a style="font-size: medium; padding:0 2px;border:solid 2px;color:yellow;" href="#ticketform_{{title}}_href">buy ticket</a></i>{{/if}}<br>

               {{/checkIf}}
               {{#checkIf postViewConfig.venue "!=" ""}}
                üìç {{ postViewConfig.venue}}
               {{/checkIf}}
               </h2>
            </header>

            {{#if @config.custom.listingFeaturedImage}}
            {{#featuredImage}}
            {{#if url}}
               <img src="{{url}}" {{#if @config.site.responsiveImages}} {{responsiveImageAttributes 'featuredImage'
                  srcset sizes}} {{/if}} {{ lazyload "lazy" }} height="{{height}}" width="{{width}}" alt="{{alt}}">

            {{/if}}
            {{/featuredImage}}
            {{/if}}

            <div class="post__content">

               {{{ text }}}
               {{#if postViewConfig.ticketsEnabled }}
               <h3 id="ticketform_{{title}}_href">Buy your "{{title}}"" tickets here:</h3>
              
                                <form id="ticketform_{{title}}" novalidate method="post">
                                    <div class="form-group inline-label">
                                       <label for="email_{{title}}">email</label>
                                        <input id="email_{{title}}" name="email" type="email" required class="form-control" placeholder="john@doe.com" />
                                    </div>
                                    <div class="form-group inline-label">
                                       <label for="quantity_{{title}}">tickets</label>
                                       <input class="form-control" type="number" id="quantity_{{title}}" name="quantity" min="1" max="5" required value="1" >
                                    </div>
                                    <div class="form-group inline-label">
                                       <label for="total_{{title}}">total</label>
                                        <input id="total_{{title}}" name="total" type="text" readonly class="form-control" value="{{ postViewConfig.ticketPresalePrice }}" />
                                    </div>
                                    
                                    <div class="form-group">
                                        <input type="submit" value="Buy" class="btn" />
                                    </div>

                                </form>
                                <br>
                                 <q><i>üí° Clicking "Buy" opens a mobilepay payment with prefilled info and amount.<br>
               Your mobilepay payment is regarded as the ticket.<br>
               Remember your given email address as we will ask for it in the door.<br>
               You will not receive a confirmation email on purchase.</i></q>
                                <script>
                                 
                                window.onload = function() {

var quantity = document.getElementById("quantity_{{title}}")
var total = document.getElementById("total_{{title}}")
      quantity.onchange = function(){
         total.value=parseInt(quantity.value) * parseInt({{ postViewConfig.ticketPresalePrice }});
      }

        var form = document.getElementById("ticketform_{{title}}")
        var pristine = new Pristine(form);
        console.log(form, pristine)
        form.addEventListener('submit', function (e) {
         console.log("submitting")
            e.preventDefault();
            var valid = pristine.validate();
            console.log("valid", valid)
            if (!valid) {
                return false
            }
            var formData = new FormData(form);
            formData = Object.fromEntries(formData)
            var mobilepaybox = "35e1b875-da6f-49d6-8b41-13c8874ee6fc"
            var message = JSON.stringify({t:"{{title}}",e:formData.email, d:"{{ date createdAt 'DD/MM/YYYY'}}", q:formData.quantity})
            var url = "https://qr.mobilepay.dk/box/"+mobilepaybox+"/pay-in?amount="+formData.total+"00&message="+message
            window.location.href = url
        });
                                }
    </script>
               {{/if}}  

            </div>
            <div class="post_paper_start"></div>

         </div>
         <div class="post_paper_end"></div>
      </article>
      
      {{/each}}
      {{> pagination}}
   </div>
   {{/if}}
   {{/tag}}
</main>
{{> footer}}