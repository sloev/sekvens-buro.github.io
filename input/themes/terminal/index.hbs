{{> head}}

{{> navbar}}
{{#checkIf @config.custom.frontSource '==' "post" }}
{{> frontpage-post}}
{{else}}
<main class="content">
   {{#if @renderer.isFirstPage}}
   {{#if @config.custom.hero}}
   <div class="hero framed">
      {{{@config.custom.textHero}}}
   </div>
   {{/if}}
   {{/if}}
   <p class="post"><b>Sekvens</b> collective has been creating events in <a href="https://maps.app.goo.gl/Te1orsQmKQ61YtHr5">Svendborg</a> since 2022.<br>
   Sekvens presents <b>groundbreaking sounds</b> from a <b>broad spectrum</b> of genres and delivers a synergy amongst acts that resembles the energy within the collective.</br>
   The focus is on creating a sustainable scene that caters to the crowd of people in our province who longs for a proper <b>club vibe</b>.<br>
   With an influx of people moving to Svendborg every year from Copenhagen, our audience grows and so does the frequency of our events.</p>
   <h1>Upcoming events üëá</h1><br>
   <div class="posts">
      {{#each @website.contentStructure.tags}}
      {{#checkIf this.name '==' 'events'}}
      {{#if this.postsNumber}}
      {{orderby this.posts 'createdAt' 'ASC'}}

      {{#each this.posts}}
      {{#checkIf (date createdAt 'X' ) '>=' (date yesterday 'X')}}

      <article class="post">
         <div class="post_content_area">

            <header>
               <h2 class="h1 post__title"><a href="{{url}}">{{title}}</a><br>
             
               ‚è∞ {{ date createdAt 'HH:mm'}}<br>
               üìÖ {{ date createdAt 'Do MMM YYYY'}}<br>
               {{#checkIf postViewConfig.ticketPresalePrice "!=" ""}}
               üé´  {{ postViewConfig.ticketPresalePrice}} kr {{#if postViewConfig.ticketsEnabled}} <i><a style="font-size: medium; padding:0 2px;border:solid 2px;color:yellow;" href="#ticketform_{{title}}">buy ticket</a></i>{{/if}}<br>

               {{/checkIf}}
               {{#checkIf postViewConfig.venue "!=" ""}}
                üìç {{ postViewConfig.venue}}
               {{/checkIf}}
               </h2>
            </header>

            {{#if @config.custom.listingFeaturedImage}}
            {{#featuredImage}}
            {{#if url}}
               <img src="{{url}}" {{#if @config.site.responsiveImages}} {{responsiveImageAttributes 'featuredImage'
                  srcset sizes}} {{/if}} {{ lazyload "lazy" }} height="{{height}}" width="{{width}}" alt="{{alt}}">

            {{/if}}
            {{/featuredImage}}
            {{/if}}

            <div class="post__content">

               {{{ text }}}
               {{#if postViewConfig.ticketsEnabled }}
               <h3>Tickets:</h3>
               <q><i>Clicking buy now will trigger a mobilepay transaction for buying tickets.<br>You will not get a confirmation email. Instead your given info is your ticket: (email + quantity) together with your mobilepay transfer</i></q>
                                <form id="ticketform_{{title}}" novalidate method="post">
                                    <div class="form-group inline-label">
                                       <label for="email_{{title}}">email</label>
                                        <input id="email_{{title}}" name="email" type="email" required class="form-control" placeholder="john@doe.com" />
                                    </div>
                                    <div class="form-group inline-label">
                                       <label for="quantity_{{title}}">tickets</label>
                                       <input class="form-control" type="number" id="quantity_{{title}}" name="quantity" min="1" max="5" required value="1" >
                                    </div>
                                    <div class="form-group inline-label">
                                       <label for="total_{{title}}">total</label>
                                        <input id="total_{{title}}" name="total" type="text" readonly class="form-control" value="{{ postViewConfig.ticketPresalePrice }}" />
                                    </div>
                                    
                                    <div class="form-group">
                                        <input type="submit" value="Buy ticket" class="btn" />
                                    </div>

                                </form>
                                <script>
                                 
                                window.onload = function() {

var quantity = document.getElementById("quantity_{{title}}")
var total = document.getElementById("total_{{title}}")
      quantity.onchange = function(){
         total.value=parseInt(quantity.value) * parseInt({{ postViewConfig.ticketPresalePrice }});
      }

        var form = document.getElementById("ticketform_{{title}}")
        var pristine = new Pristine(form);
        console.log(form, pristine)
        form.addEventListener('submit', function (e) {
         console.log("submitting")
            e.preventDefault();
            var valid = pristine.validate();
            console.log("valid", valid)
            if (!valid) {
                return false
            }
            var formData = new FormData(form);
            formData = Object.fromEntries(formData)
            var mobilepaybox = "35e1b875-da6f-49d6-8b41-13c8874ee6fc"
            var message = JSON.stringify({t:"{{title}}",e:formData.email, d:"{{ date createdAt 'DD/MM/YYYY'}}", q:formData.quantity})
            var url = "https://qr.mobilepay.dk/box/"+mobilepaybox+"/pay-in?amount="+formData.total+"00&message="+message
            window.open(url, "_blank")
            window.location.href = "https://sekvens.buro.earth/ticketpurchased"
        });
                                }
    </script>
               {{/if}}

            </div>
            <div class="post_paper_start"></div>

         </div>
         <div class="post_paper_end"></div>
      </article>
      {{/checkIf}}

      {{/each}}
      {{else}}
      {{/if}}
      {{/checkIf}}

      {{/each}}


   </div>

</main>
{{/checkIf}}
{{> footer}}